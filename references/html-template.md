# HTML Template Reference

Use this template structure when generating the code review HTML file.

## Full Template

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Review</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      margin: 0;
      padding: 24px;
      background: #0d1117;
      color: #e6edf3;
      line-height: 1.5;
    }

    .review-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #30363d;
    }

    .review-header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
    }

    .review-meta {
      color: #8b949e;
      font-size: 14px;
    }

    .stats {
      display: flex;
      gap: 16px;
      color: #8b949e;
      font-size: 14px;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-value {
      color: #e6edf3;
      font-weight: 600;
    }

    .file-section {
      margin-bottom: 32px;
      border: 1px solid #30363d;
      border-radius: 6px;
      overflow: hidden;
    }

    .file-header {
      background: #161b22;
      padding: 12px 16px;
      border-bottom: 1px solid #30363d;
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
      font-size: 13px;
      color: #e6edf3;
    }

    .file-path {
      font-weight: 600;
    }

    .diff-container {
      background: #0d1117;
    }

    /* Annotation comment styling */
    .review-comment {
      background: #1c2128;
      border-left: 3px solid #8b5cf6;
      padding: 12px 16px;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .comment-author {
      font-weight: 600;
      color: #8b5cf6;
      font-size: 13px;
    }

    .comment-badge {
      background: #8b5cf620;
      color: #8b5cf6;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .comment-message {
      color: #e6edf3;
      font-size: 14px;
      margin: 0;
    }

    .loading {
      text-align: center;
      padding: 48px;
      color: #8b949e;
    }

    .error {
      background: #f8514920;
      border: 1px solid #f85149;
      border-radius: 6px;
      padding: 16px;
      color: #f85149;
      margin: 16px 0;
    }

    /* Override pierre/diffs styles for consistency */
    diffs-container {
      --diffs-font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
      --diffs-font-size: 13px;
      --diffs-line-height: 20px;
    }
  </style>
</head>
<body>
  <div class="review-container">
    <header class="review-header">
      <div>
        <h1>Code Review</h1>
        <div class="review-meta">
          Generated by Claude | <span id="source-info"></span>
        </div>
      </div>
      <div class="stats">
        <div class="stat">
          <span>Files:</span>
          <span class="stat-value" id="file-count">0</span>
        </div>
        <div class="stat">
          <span>Comments:</span>
          <span class="stat-value" id="comment-count">0</span>
        </div>
      </div>
    </header>

    <main id="review-content">
      <div class="loading">Loading diff viewer...</div>
    </main>
  </div>

  <script type="module">
    // ============================================================
    // REVIEW DATA - Claude generates this section
    // ============================================================
    const reviewData = {
      generatedAt: "TIMESTAMP",
      source: "SOURCE_TYPE", // "branch" or "uncommitted"
      baseBranch: "BRANCH_NAME",
      files: [
        // Each file object:
        // {
        //   path: "src/example.ts",
        //   patch: "--- a/src/example.ts\n+++ b/src/example.ts\n...",
        //   annotations: [
        //     {
        //       side: "additions",
        //       lineNumber: 15,
        //       metadata: {
        //         author: "Claude",
        //         message: "Review comment here"
        //       }
        //     }
        //   ]
        // }
      ]
    };
    // ============================================================

    // Render annotation comments
    function renderAnnotation(annotation) {
      const wrapper = document.createElement('div');
      wrapper.className = 'review-comment';

      const header = document.createElement('div');
      header.className = 'comment-header';

      const author = document.createElement('span');
      author.className = 'comment-author';
      author.textContent = annotation.metadata?.author || 'Claude';

      const badge = document.createElement('span');
      badge.className = 'comment-badge';
      badge.textContent = 'Review';

      header.appendChild(author);
      header.appendChild(badge);

      const message = document.createElement('p');
      message.className = 'comment-message';
      message.textContent = annotation.metadata?.message || '';

      wrapper.appendChild(header);
      wrapper.appendChild(message);

      return wrapper;
    }

    // Main render function
    async function render() {
      const content = document.getElementById('review-content');

      try {
        // Dynamic import from CDN
        const { FileDiff, parsePatchFiles } = await import(
          'https://cdn.jsdelivr.net/npm/@pierre/diffs@1/dist/index.js'
        );

        content.innerHTML = '';

        // Update header info
        document.getElementById('source-info').textContent =
          reviewData.source === 'branch'
            ? `Branch diff from ${reviewData.baseBranch}`
            : 'Uncommitted changes';

        let totalComments = 0;

        // Render each file
        for (const file of reviewData.files) {
          const fileSection = document.createElement('div');
          fileSection.className = 'file-section';

          // File header
          const fileHeader = document.createElement('div');
          fileHeader.className = 'file-header';
          fileHeader.innerHTML = `<span class="file-path">${file.path}</span>`;
          fileSection.appendChild(fileHeader);

          // Diff container
          const diffContainer = document.createElement('div');
          diffContainer.className = 'diff-container';
          fileSection.appendChild(diffContainer);

          content.appendChild(fileSection);

          // Parse and render diff
          const parsed = parsePatchFiles(file.patch);
          if (!parsed || parsed.length === 0 || !parsed[0].files || parsed[0].files.length === 0) {
            diffContainer.innerHTML = '<div class="error">Failed to parse diff</div>';
            continue;
          }

          const fileDiff = parsed[0].files[0];

          const renderer = new FileDiff({
            theme: { dark: 'pierre-dark', light: 'pierre-light' },
            themeType: 'dark',
            diffStyle: 'split',
            overflow: 'scroll',
            diffIndicators: 'bars',
            renderAnnotation: renderAnnotation
          });

          await renderer.render({
            fileDiff: fileDiff,
            containerWrapper: diffContainer,
            lineAnnotations: file.annotations || []
          });

          totalComments += (file.annotations || []).length;
        }

        // Update stats
        document.getElementById('file-count').textContent = reviewData.files.length;
        document.getElementById('comment-count').textContent = totalComments;

      } catch (error) {
        content.innerHTML = `<div class="error">
          <strong>Error loading diff viewer:</strong><br>
          ${error.message}
        </div>`;
        console.error('Failed to render:', error);
      }
    }

    render();
  </script>
</body>
</html>
```

## Key Customization Points

### 1. Review Data Object

Replace the `reviewData` object with actual data:

```javascript
const reviewData = {
  generatedAt: new Date().toISOString(),
  source: "branch",           // or "uncommitted"
  baseBranch: "main",         // the base branch name
  files: [
    {
      path: "src/file.ts",
      patch: "...",           // full git diff patch for this file
      annotations: [...]       // array of review comments
    }
  ]
};
```

### 2. Annotations Array

Each annotation needs:
- `side`: `"additions"` or `"deletions"`
- `lineNumber`: Line number in the file (1-indexed)
- `metadata.author`: `"Claude"` (or custom)
- `metadata.message`: The review comment text

### 3. Theme Options

Available themes for `themeType`:
- `'dark'` - Dark mode (matches diffs.com)
- `'light'` - Light mode
- `'system'` - Follow system preference

### 4. Diff Style Options

- `diffStyle: 'split'` - Side-by-side view (default)
- `diffStyle: 'unified'` - Stacked/unified view

## Notes

- The template uses ES modules with dynamic import from CDN
- No build step required - just save and open in browser
- Styling matches GitHub/diffs.com dark theme aesthetic
- Review comments have a purple accent (`#8b5cf6`) for visibility
