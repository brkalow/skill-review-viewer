# HTML Template Reference

Use this template structure when generating the code review HTML file.

## Full Template

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Review</title>
  <script type="importmap">
  {
    "imports": {
      "shiki": "https://esm.sh/shiki@1",
      "@pierre/diffs": "https://esm.sh/@pierre/diffs@1"
    }
  }
  </script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      margin: 0;
      padding: 24px;
      background: #070707;
      color: #fbfbfb;
      line-height: 1.5;
    }

    .review-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #424245;
    }

    .review-header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
    }

    .review-meta {
      color: #84848A;
      font-size: 14px;
    }

    .review-meta a {
      color: #009fff;
      text-decoration: none;
    }

    .review-meta a:hover {
      text-decoration: underline;
    }

    .stats {
      display: flex;
      gap: 16px;
      color: #84848A;
      font-size: 14px;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-value {
      color: #fbfbfb;
      font-weight: 600;
    }

    .diff-wrapper {
      margin-bottom: 24px;
      border: 1px solid #424245;
      border-radius: 8px;
      overflow: hidden;
    }

    .changes-summary {
      background: #141415;
      border: 1px solid #424245;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
      color: #adadb1;
      font-size: 14px;
      line-height: 1.6;
    }

    .changes-summary:empty {
      display: none;
    }

    /* Annotation comment styling - GitHub-style review comments */
    .review-comment {
      background: #141415;
      border: 1px solid #424245;
      border-radius: 8px;
      padding: 12px 16px;
      margin: 12px 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #009fff 0%, #9d6afb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      color: #070707;
      flex-shrink: 0;
    }

    .comment-meta {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .comment-author {
      font-weight: 600;
      color: #fbfbfb;
      font-size: 14px;
    }

    .comment-time {
      color: #84848A;
      font-size: 12px;
    }

    .comment-message {
      color: #adadb1;
      font-size: 14px;
      margin: 0;
      line-height: 1.5;
    }

    .loading {
      text-align: center;
      padding: 48px;
      color: #84848A;
    }

    .error {
      background: #ff2e3f20;
      border: 1px solid #ff2e3f;
      border-radius: 6px;
      padding: 16px;
      color: #ff2e3f;
      margin: 16px 0;
    }

    /* Override pierre/diffs styles for consistency */
    diffs-container {
      --diffs-font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace;
      --diffs-font-size: 13px;
      --diffs-line-height: 20px;
    }
  </style>
</head>
<body>
  <div class="review-container">
    <header class="review-header">
      <div>
        <h1>Code Review</h1>
        <div class="review-meta">
          Generated by Claude | <span id="source-info"></span>
        </div>
      </div>
      <div class="stats">
        <div class="stat">
          <span>Files:</span>
          <span class="stat-value" id="file-count">0</span>
        </div>
        <div class="stat">
          <span>Comments:</span>
          <span class="stat-value" id="comment-count">0</span>
        </div>
      </div>
    </header>

    <section class="changes-summary" id="changes-summary"></section>

    <main id="review-content">
      <div class="loading">Loading diff viewer...</div>
    </main>
  </div>

  <script type="module">
    // ============================================================
    // REVIEW DATA - Claude generates this section
    // ============================================================
    const reviewData = {
      generatedAt: "TIMESTAMP",
      source: "SOURCE_TYPE", // "branch", "uncommitted", or "commit"
      baseBranch: "BRANCH_NAME",
      repository: null,      // "user/repo-name" or null if not available
      repositoryUrl: null,   // "https://github.com/user/repo-name" or null
      prUrl: null,           // "https://github.com/user/repo/pull/123" or null
      summary: "CHANGES_SUMMARY", // brief summary of what the changes do
      files: [
        // Each file object:
        // {
        //   path: "src/example.ts",
        //   patch: "--- a/src/example.ts\n+++ b/src/example.ts\n...",
        //   annotations: [
        //     {
        //       side: "additions",
        //       lineNumber: 15,
        //       metadata: {
        //         author: "Claude",
        //         message: "Review comment here"
        //       }
        //     }
        //   ]
        // }
      ]
    };
    // ============================================================

    // Render annotation comments - GitHub-style
    function renderAnnotation(annotation) {
      const wrapper = document.createElement('div');
      wrapper.className = 'review-comment';

      const header = document.createElement('div');
      header.className = 'comment-header';

      // Avatar with initial
      const avatar = document.createElement('div');
      avatar.className = 'comment-avatar';
      const authorName = annotation.metadata?.author || 'Claude';
      avatar.textContent = authorName.charAt(0).toUpperCase();

      // Meta info (author + time)
      const meta = document.createElement('div');
      meta.className = 'comment-meta';

      const author = document.createElement('span');
      author.className = 'comment-author';
      author.textContent = authorName;

      const time = document.createElement('span');
      time.className = 'comment-time';
      time.textContent = 'now';

      meta.appendChild(author);
      meta.appendChild(time);

      header.appendChild(avatar);
      header.appendChild(meta);

      const message = document.createElement('p');
      message.className = 'comment-message';
      message.textContent = annotation.metadata?.message || '';

      wrapper.appendChild(header);
      wrapper.appendChild(message);

      return wrapper;
    }

    // Main render function
    async function render() {
      const content = document.getElementById('review-content');

      try {
        // Dynamic import using import map
        const { FileDiff, parsePatchFiles } = await import('@pierre/diffs');

        content.innerHTML = '';

        // Update header info
        const sourceInfo = document.getElementById('source-info');
        let sourceText = reviewData.source === 'branch'
          ? `Branch diff from ${reviewData.baseBranch}`
          : reviewData.source === 'commit'
          ? `Commit ${reviewData.baseBranch}`
          : 'Uncommitted changes';

        let headerParts = [];

        // Add repository link if available
        if (reviewData.repository && reviewData.repositoryUrl) {
          headerParts.push(`<a href="${reviewData.repositoryUrl}" target="_blank">${reviewData.repository}</a>`);
        } else if (reviewData.repository) {
          headerParts.push(reviewData.repository);
        }

        headerParts.push(sourceText);

        // Add PR link if available
        if (reviewData.prUrl) {
          headerParts.push(`<a href="${reviewData.prUrl}" target="_blank">View PR</a>`);
        }

        sourceInfo.innerHTML = headerParts.join(' Â· ');

        // Display changes summary
        const summaryEl = document.getElementById('changes-summary');
        if (reviewData.summary) {
          summaryEl.textContent = reviewData.summary;
        }

        let totalComments = 0;

        // Render each file
        for (const file of reviewData.files) {
          // Create wrapper for spacing between files
          const diffWrapper = document.createElement('div');
          diffWrapper.className = 'diff-wrapper';
          content.appendChild(diffWrapper);

          // Parse and render diff
          const parsed = parsePatchFiles(file.patch);
          if (!parsed || parsed.length === 0 || !parsed[0].files || parsed[0].files.length === 0) {
            diffWrapper.innerHTML = `<div class="error">Failed to parse diff for ${file.path}</div>`;
            continue;
          }

          const fileDiff = parsed[0].files[0];

          const renderer = new FileDiff({
            theme: { dark: 'pierre-dark', light: 'pierre-light' },
            themeType: 'dark',
            diffStyle: 'split',
            overflow: 'scroll',
            diffIndicators: 'bars',
            renderAnnotation: renderAnnotation
          });

          await renderer.render({
            fileDiff: fileDiff,
            containerWrapper: diffWrapper,
            lineAnnotations: file.annotations || []
          });

          totalComments += (file.annotations || []).length;
        }

        // Update stats
        document.getElementById('file-count').textContent = reviewData.files.length;
        document.getElementById('comment-count').textContent = totalComments;

      } catch (error) {
        content.innerHTML = `<div class="error">
          <strong>Error loading diff viewer:</strong><br>
          ${error.message}
        </div>`;
        console.error('Failed to render:', error);
      }
    }

    render();
  </script>
</body>
</html>
```

## Key Customization Points

### 1. Review Data Object

Replace the `reviewData` object with actual data:

```javascript
const reviewData = {
  generatedAt: new Date().toISOString(),
  source: "branch",           // "branch", "uncommitted", or "commit"
  baseBranch: "main",         // the base branch name or commit SHA
  repository: "user/repo",    // optional: extracted from git remote
  repositoryUrl: "https://github.com/user/repo",  // optional: for header link
  prUrl: "https://...",       // optional: from `gh pr view`
  summary: "Brief description of what the changes do",  // displayed below header
  files: [
    {
      path: "src/file.ts",
      patch: "...",           // full git diff patch for this file
      annotations: [...]       // array of review comments
    }
  ]
};
```

To get repository and PR info:
```bash
# Extract repo from remote URL
REPO=$(git remote get-url origin 2>/dev/null | sed 's/.*github.com[:/]\(.*\)\.git/\1/')

# Build repository URL
REPO_URL="https://github.com/${REPO}"

# Get PR URL (requires GitHub CLI)
gh pr view --json url --jq '.url' 2>/dev/null
```

### 2. Annotations Array

Each annotation needs:
- `side`: `"additions"` or `"deletions"`
- `lineNumber`: Line number in the file (1-indexed)
- `metadata.author`: `"Claude"` (or custom)
- `metadata.message`: The review comment text

### 3. Theme Options

Available themes for `themeType`:
- `'dark'` - Dark mode (matches diffs.com)
- `'light'` - Light mode
- `'system'` - Follow system preference

### 4. Diff Style Options

- `diffStyle: 'split'` - Side-by-side view (default)
- `diffStyle: 'unified'` - Stacked/unified view

## Color Palette (pierre-dark theme)

| Element | Color |
|---------|-------|
| Background | `#070707` |
| Text | `#fbfbfb` |
| Secondary text | `#84848A` |
| Muted text | `#adadb1` |
| Borders | `#424245` |
| Card background | `#141415` |
| Accent blue | `#009fff` |
| Accent purple | `#9d6afb` |
| Error red | `#ff2e3f` |
| Addition green | `#00cab1` |

## Notes

- The template uses ES modules with import map for shiki and @pierre/diffs via esm.sh
- No build step required - just save and open in browser
- Styling matches diffs.com dark theme aesthetic
- Review comments have avatar with gradient, author name, and timestamp
